<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SecurePosture ‚Äî CISO Security Platform</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,300&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #0a0e1a;
  --bg-secondary: #111827;
  --bg-card: #1a2035;
  --bg-card-hover: #1f2847;
  --bg-sidebar: #0d1220;
  --border: #2a3554;
  --border-light: #374167;
  --text-primary: #e8ecf4;
  --text-secondary: #8896b3;
  --text-muted: #5a6a8a;
  --green: #22c55e; --green-dim: rgba(34,197,94,0.15);
  --yellow: #eab308; --yellow-dim: rgba(234,179,8,0.15);
  --orange: #f97316; --orange-dim: rgba(249,115,22,0.15);
  --red: #ef4444; --red-dim: rgba(239,68,68,0.15);
  --blue: #3b82f6; --blue-dim: rgba(59,130,246,0.12);
  --purple: #8b5cf6; --purple-dim: rgba(139,92,246,0.12);
  --cyan: #06b6d4;
  --radius: 10px;
  --radius-sm: 6px;
  --shadow: 0 4px 24px rgba(0,0,0,0.3);
  --transition: 0.2s ease;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'DM Sans',sans-serif; background:var(--bg-primary); color:var(--text-primary); height:100vh; overflow:hidden; display:flex; }
::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }

/* Sidebar */
.sidebar {
  width: 260px; min-width:260px;
  background: var(--bg-sidebar);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column;
  height: 100vh;
  overflow-y: auto;
}
.sidebar-brand {
  padding: 20px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 12px;
}
.sidebar-brand .shield {
  width: 36px; height: 36px;
  background: linear-gradient(135deg, var(--blue), var(--purple));
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 18px;
}
.sidebar-brand .brand-text h1 { font-size: 15px; font-weight: 700; letter-spacing: -0.02em; }
.sidebar-brand .brand-text span { font-size: 11px; color: var(--text-muted); }

.sidebar-section { padding: 16px 12px 4px; }
.sidebar-section-label {
  font-size: 10px; font-weight: 700; text-transform: uppercase;
  letter-spacing: 0.08em; color: var(--text-muted); padding: 0 8px; margin-bottom: 6px;
}
.sidebar-item {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 12px; border-radius: var(--radius-sm);
  font-size: 13px; color: var(--text-secondary);
  cursor: pointer; transition: var(--transition);
  border: 1px solid transparent; margin-bottom: 2px;
}
.sidebar-item:hover { background: var(--bg-card); color: var(--text-primary); }
.sidebar-item.active {
  background: var(--blue-dim); color: var(--blue);
  border-color: rgba(59,130,246,0.2);
}
.sidebar-item .icon { font-size: 16px; width: 20px; text-align: center; }
.sidebar-item .badge {
  margin-left: auto; font-size: 10px; font-weight: 600;
  padding: 2px 7px; border-radius: 10px;
  font-family: 'JetBrains Mono', monospace;
}
.badge-red { background: var(--red-dim); color: var(--red); }
.badge-yellow { background: var(--yellow-dim); color: var(--yellow); }
.badge-green { background: var(--green-dim); color: var(--green); }
.badge-blue { background: var(--blue-dim); color: var(--blue); }

/* Main */
.main-wrapper {
  flex: 1; display: flex; flex-direction: column;
  height: 100vh; overflow: hidden;
}
.topbar {
  padding: 12px 28px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  background: rgba(10,14,26,0.7);
  backdrop-filter: blur(12px);
  min-height: 52px;
}
.topbar h2 { font-size: 17px; font-weight: 600; letter-spacing: -0.02em; }
.topbar .meta { font-size: 12px; color: var(--text-muted); display:flex; align-items:center; gap:16px; }
.topbar .live-dot {
  width:7px; height:7px; background:var(--green); border-radius:50%;
  display:inline-block; margin-right:4px;
  animation: pulse 2s infinite;
}
@keyframes pulse {
  0%,100% { box-shadow:0 0 0 0 rgba(34,197,94,0.4); }
  50% { box-shadow:0 0 0 5px rgba(34,197,94,0); }
}

.content { flex:1; overflow-y:auto; padding:24px 28px 48px; }

/* View sections */
.view { display:none; }
.view.active { display:block; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }

/* Cards */
.card {
  background:var(--bg-card); border:1px solid var(--border);
  border-radius:var(--radius); padding:20px;
  margin-bottom:16px; transition:var(--transition);
}
.card:hover { border-color:var(--border-light); }
.card-title {
  font-size:11px; font-weight:700; text-transform:uppercase;
  letter-spacing:0.06em; color:var(--text-muted); margin-bottom:14px;
}

/* Grid */
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:16px}
.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:16px}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-bottom:16px}
.grid-2-1{display:grid;grid-template-columns:2fr 1fr;gap:14px;margin-bottom:16px}
.grid-1-2{display:grid;grid-template-columns:1fr 2fr;gap:14px;margin-bottom:16px}

/* KPI */
.kpi .value {
  font-size:32px; font-weight:700; letter-spacing:-0.03em;
  font-family:'JetBrains Mono',monospace; line-height:1.1; margin-bottom:4px;
}
.kpi .label { font-size:12px; color:var(--text-secondary); }
.kpi .trend {
  font-size:11px; font-family:'JetBrains Mono',monospace;
  margin-top:8px; display:inline-flex; align-items:center; gap:3px;
  padding:2px 7px; border-radius:5px;
}

/* Buttons */
.btn {
  padding:8px 18px; border-radius:var(--radius-sm);
  font-size:13px; font-weight:500; font-family:inherit;
  cursor:pointer; transition:var(--transition); border:1px solid var(--border);
  background:var(--bg-card); color:var(--text-primary);
  display:inline-flex; align-items:center; gap:6px;
}
.btn:hover { background:var(--bg-card-hover); border-color:var(--border-light); }
.btn-primary { background:var(--blue); border-color:var(--blue); color:#fff; }
.btn-primary:hover { background:#2563eb; }
.btn-sm { padding:5px 12px; font-size:12px; }

/* Tables */
.data-table { width:100%; border-collapse:separate; border-spacing:0; }
.data-table th {
  font-size:10px; font-weight:700; text-transform:uppercase;
  letter-spacing:0.06em; color:var(--text-muted);
  text-align:left; padding:10px 12px;
  border-bottom:1px solid var(--border);
  background:var(--bg-card); position:sticky; top:0; z-index:2;
}
.data-table td {
  padding:10px 12px; font-size:13px;
  border-bottom:1px solid rgba(42,53,84,0.3);
}
.data-table tr:hover td { background:rgba(255,255,255,0.015); }
.score-badge {
  display:inline-flex; align-items:center; padding:3px 9px;
  border-radius:5px; font-family:'JetBrains Mono',monospace;
  font-size:11px; font-weight:600;
}

/* Heatmap */
.heatmap-grid { display:grid; gap:4px; }
.heatmap-row { display:grid; gap:4px; align-items:center; }
.heatmap-label { font-size:11px; color:var(--text-secondary); text-align:right; padding-right:6px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.heatmap-header { font-size:9px; font-weight:700; text-transform:uppercase; letter-spacing:0.04em; color:var(--text-muted); text-align:center; }
.heatmap-cell {
  border-radius:4px; display:flex; align-items:center; justify-content:center;
  font-size:10px; font-family:'JetBrains Mono',monospace; font-weight:600;
  cursor:pointer; transition:var(--transition); min-height:30px;
}
.heatmap-cell:hover { transform:scale(1.08); z-index:5; box-shadow:var(--shadow); }

/* Score ring */
.score-ring { position:relative; width:120px; height:120px; }
.score-ring svg { transform:rotate(-90deg); }
.score-ring .ring-bg { fill:none; stroke:var(--border); stroke-width:7; }
.score-ring .ring-fill { fill:none; stroke-width:7; stroke-linecap:round; transition:stroke-dashoffset 1.5s cubic-bezier(0.4,0,0.2,1); }
.score-ring .ring-label {
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center;
}
.score-ring .ring-label .num { font-size:28px; font-weight:700; font-family:'JetBrains Mono',monospace; }
.score-ring .ring-label .of { font-size:10px; color:var(--text-muted); }

/* Bar */
.bar-row { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
.bar-row .bar-label { width:160px; font-size:11px; color:var(--text-secondary); text-align:right; flex-shrink:0; }
.bar-track { flex:1; height:24px; background:rgba(255,255,255,0.04); border-radius:5px; overflow:hidden; }
.bar-fill { height:100%; border-radius:5px; position:relative; transition:width 1s ease; }
.bar-fill::after { content:attr(data-value); position:absolute; right:6px; top:50%; transform:translateY(-50%); font-size:10px; font-family:'JetBrains Mono',monospace; font-weight:600; color:#fff; }
.bar-score { width:36px; font-size:12px; font-family:'JetBrains Mono',monospace; font-weight:600; text-align:right; }

/* Form */
.form-group { margin-bottom:16px; }
.form-group label {
  display:block; font-size:12px; font-weight:600; color:var(--text-secondary);
  margin-bottom:5px; text-transform:uppercase; letter-spacing:0.04em;
}
.form-control {
  width:100%; padding:9px 12px; border-radius:var(--radius-sm);
  border:1px solid var(--border); background:var(--bg-secondary);
  color:var(--text-primary); font-family:inherit; font-size:13px;
  transition:var(--transition);
}
.form-control:focus { outline:none; border-color:var(--blue); box-shadow:0 0 0 3px var(--blue-dim); }
select.form-control { cursor:pointer; }
textarea.form-control { resize:vertical; min-height:70px; }

/* Tags */
.tag-list { display:flex; flex-wrap:wrap; gap:6px; margin-top:6px; }
.tag {
  display:inline-flex; align-items:center; gap:4px;
  padding:4px 10px; border-radius:12px;
  font-size:11px; font-weight:500;
  background:var(--blue-dim); color:var(--blue);
  border:1px solid rgba(59,130,246,0.2);
}
.tag .tag-remove { cursor:pointer; opacity:0.6; }
.tag .tag-remove:hover { opacity:1; }

/* Tree */
.tree-item {
  padding:8px 12px; margin-left:20px; border-left:2px solid var(--border);
  cursor:pointer; transition:var(--transition); font-size:13px;
}
.tree-item:hover { background:var(--bg-card-hover); border-left-color:var(--blue); }
.tree-item.root { margin-left:0; border-left:none; font-weight:600; font-size:14px; }
.tree-item .tree-meta { font-size:11px; color:var(--text-muted); margin-top:2px; }
.tree-item .tree-badge {
  float:right; font-size:10px; padding:2px 8px; border-radius:4px;
  font-family:'JetBrains Mono',monospace;
}

/* Modal */
.modal-overlay {
  position:fixed; top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.6); backdrop-filter:blur(6px);
  z-index:300; display:none; align-items:center; justify-content:center;
}
.modal-overlay.active { display:flex; }
.modal {
  background:var(--bg-secondary); border:1px solid var(--border);
  border-radius:12px; width:90%; max-width:700px; max-height:85vh;
  overflow-y:auto; box-shadow:0 8px 40px rgba(0,0,0,0.5);
  animation: modalIn 0.25s ease;
}
@keyframes modalIn { from{opacity:0;transform:scale(0.96)} to{opacity:1;transform:scale(1)} }
.modal-header {
  display:flex; align-items:center; justify-content:space-between;
  padding:18px 22px; border-bottom:1px solid var(--border);
}
.modal-header h3 { font-size:16px; font-weight:600; }
.modal-close {
  width:30px; height:30px; border-radius:6px; border:1px solid var(--border);
  background:transparent; color:var(--text-secondary); cursor:pointer;
  font-size:14px; display:flex; align-items:center; justify-content:center;
}
.modal-close:hover { background:var(--bg-card); }
.modal-body { padding:22px; }

/* CIS specific */
.cis-control-card {
  background:var(--bg-card); border:1px solid var(--border);
  border-radius:var(--radius); margin-bottom:8px;
  overflow:hidden; transition:var(--transition);
}
.cis-control-header {
  padding:14px 18px; cursor:pointer; display:flex;
  align-items:center; justify-content:space-between;
  transition:var(--transition);
}
.cis-control-header:hover { background:var(--bg-card-hover); }
.cis-control-header .csc-title { display:flex; align-items:center; gap:10px; }
.cis-control-header .csc-num {
  font-family:'JetBrains Mono',monospace; font-size:11px;
  color:var(--text-muted); min-width:50px;
}
.cis-control-header .csc-name { font-size:13px; font-weight:500; }
.cis-control-header .csc-score {
  font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:600;
}
.cis-control-body { display:none; padding:0 18px 16px; }
.cis-control-card.expanded .cis-control-body { display:block; }
.cis-control-card.expanded .cis-control-header { border-bottom:1px solid var(--border); }

.cis-sub-row {
  display:grid; grid-template-columns:60px 1fr repeat(4,110px);
  gap:8px; align-items:center; padding:8px 0;
  border-bottom:1px solid rgba(42,53,84,0.25);
  font-size:12px;
}
.cis-sub-row:last-child { border-bottom:none; }
.cis-sub-id { font-family:'JetBrains Mono',monospace; color:var(--text-muted); font-size:11px; }
.cis-sub-name { color:var(--text-secondary); line-height:1.3; }
.cis-select {
  padding:5px 8px; border-radius:4px; border:1px solid var(--border);
  background:var(--bg-secondary); color:var(--text-primary);
  font-size:11px; font-family:inherit; cursor:pointer; width:100%;
}

/* Legend */
.legend { display:flex; gap:14px; flex-wrap:wrap; margin-top:10px; }
.legend-item { display:flex; align-items:center; gap:5px; font-size:11px; color:var(--text-secondary); }
.legend-dot { width:10px; height:10px; border-radius:3px; }

/* Responsive */
@media(max-width:1100px) {
  .sidebar { width:60px; min-width:60px; }
  .sidebar .brand-text, .sidebar-section-label, .sidebar-item span:not(.icon), .sidebar-item .badge { display:none; }
  .sidebar-item { justify-content:center; padding:10px; }
  .grid-4{grid-template-columns:repeat(2,1fr)}
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<nav class="sidebar">
  <div class="sidebar-brand">
    <div class="shield">üõ°</div>
    <div class="brand-text">
      <h1>SecurePosture</h1>
      <span>CISO Platform</span>
    </div>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-label">Dashboardy</div>
    <div class="sidebar-item active" data-view="dashboard">
      <span class="icon">üìä</span><span>Executive Summary</span>
    </div>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-label">ZarzƒÖdzanie Ryzykiem</div>
    <div class="sidebar-item" data-view="risks">
      <span class="icon">‚ö†Ô∏è</span><span>Rejestr Ryzyk</span>
      <span class="badge badge-red">3</span>
    </div>
    <div class="sidebar-item" data-view="reviews">
      <span class="icon">üîÑ</span><span>PrzeglƒÖdy</span>
      <span class="badge badge-yellow">5</span>
    </div>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-label">CIS Benchmark</div>
    <div class="sidebar-item" data-view="cis-list">
      <span class="icon">üìã</span><span>Lista Ocen</span>
    </div>
    <div class="sidebar-item" data-view="cis-assess">
      <span class="icon">‚úÖ</span><span>Formularz Oceny</span>
    </div>
  </div>

  <div class="sidebar-section">
    <div class="sidebar-section-label">Konfiguracja</div>
    <div class="sidebar-item" data-view="org-structure">
      <span class="icon">üè¢</span><span>Struktura Org.</span>
    </div>
    <div class="sidebar-item" data-view="catalogs">
      <span class="icon">üìö</span><span>Katalogi</span>
    </div>
    <div class="sidebar-item" data-view="dictionaries">
      <span class="icon">üìñ</span><span>S≈Çowniki</span>
    </div>
    <div class="sidebar-item" data-view="audit">
      <span class="icon">üìù</span><span>Audit Trail</span>
    </div>
  </div>
</nav>

<!-- MAIN -->
<div class="main-wrapper">
  <div class="topbar">
    <h2 id="topbar-title">Executive Summary</h2>
    <div class="meta">
      <span><span class="live-dot"></span>Dane aktualne</span>
      <span>09.02.2026, 08:00</span>
    </div>
  </div>

  <div class="content">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view active" id="view-dashboard">
      <div class="grid-4" id="dash-kpis"></div>
      <div class="grid-2-1">
        <div class="card">
          <div class="card-title">Heatmapa: Obszary Ryzyka √ó Piony Biznesowe</div>
          <div id="dash-heatmap"></div>
          <div class="legend" style="margin-top:12px">
            <div class="legend-item"><div class="legend-dot" style="background:var(--green)"></div>Dobry ‚â•75</div>
            <div class="legend-item"><div class="legend-dot" style="background:var(--yellow)"></div>≈öredni 50‚Äì74</div>
            <div class="legend-item"><div class="legend-dot" style="background:var(--orange)"></div>Niski 25‚Äì49</div>
            <div class="legend-item"><div class="legend-dot" style="background:var(--red)"></div>Krytyczny <25</div>
          </div>
        </div>
        <div>
          <div class="card" style="text-align:center;">
            <div class="card-title">Og√≥lny Wynik</div>
            <div id="dash-ring" style="display:flex;justify-content:center;padding:8px 0;"></div>
          </div>
          <div class="card">
            <div class="card-title">CIS Maturity</div>
            <div id="dash-cis-mini"></div>
          </div>
        </div>
      </div>
      <div class="grid-2">
        <div class="card">
          <div class="card-title">TOP 5 Ryzyk Krytycznych</div>
          <div id="dash-top-risks"></div>
        </div>
        <div class="card">
          <div class="card-title">Przeterminowane PrzeglƒÖdy</div>
          <div id="dash-overdue"></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RISK REGISTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-risks">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <select class="form-control" style="width:160px"><option>Wszystkie piony</option><option>Rozw√≥j Oprogramowania</option><option>Infrastruktura & Ops</option><option>Konsulting IT</option><option>Us≈Çugi Chmurowe</option><option>Dane & AI</option><option>Wsparcie Techniczne</option></select>
          <select class="form-control" style="width:160px"><option>Wszystkie statusy</option><option>Zidentyfikowane</option><option>W analizie</option><option>W mitygacji</option><option>Zaakceptowane</option><option>Zamkniƒôte</option></select>
          <select class="form-control" style="width:140px"><option>Poziom ryzyka</option><option>üî¥ Wysokie</option><option>üü° ≈örednie</option><option>üü¢ Niskie</option></select>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-sm">üì• Eksport</button>
          <button class="btn btn-primary btn-sm" onclick="showModal('risk-form')">+ Dodaj ryzyko</button>
        </div>
      </div>
      <div class="card" style="padding:0;overflow:hidden;">
        <table class="data-table" id="risk-table"></table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REVIEWS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-reviews">
      <div class="grid-3">
        <div class="card kpi"><div class="value" style="color:var(--red)">5</div><div class="label">Przeterminowane przeglƒÖdy</div></div>
        <div class="card kpi"><div class="value" style="color:var(--yellow)">8</div><div class="label">Do przeglƒÖdu w tym miesiƒÖcu</div></div>
        <div class="card kpi"><div class="value" style="color:var(--green)">23</div><div class="label">Aktualne</div></div>
      </div>
      <div class="card">
        <div class="card-title">Ryzyka WymagajƒÖce PrzeglƒÖdu <span style="color:var(--red)">(przeterminowane &gt;90 dni)</span></div>
        <table class="data-table" id="review-table"></table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CIS LIST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-cis-list">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <div style="display:flex;gap:8px;">
          <select class="form-control" style="width:180px"><option>Wszystkie jednostki</option><option>Ca≈Ça organizacja</option><option>Rozw√≥j Oprogramowania</option><option>Infrastruktura & Ops</option></select>
        </div>
        <button class="btn btn-primary btn-sm" onclick="switchView('cis-assess')">+ Nowa ocena</button>
      </div>
      <div class="card" style="padding:0;overflow:hidden;">
        <table class="data-table" id="cis-list-table"></table>
      </div>
      <div class="grid-2" style="margin-top:16px;">
        <div class="card">
          <div class="card-title">Trend Maturity Rating</div>
          <div id="cis-trend-chart" style="height:200px;display:flex;align-items:center;justify-content:center;">
            <svg width="100%" viewBox="0 0 500 180" style="max-width:500px">
              <line x1="50" y1="160" x2="460" y2="160" stroke="var(--border)" stroke-width="1"/>
              <line x1="50" y1="10" x2="50" y2="160" stroke="var(--border)" stroke-width="1"/>
              <text x="20" y="165" fill="var(--text-muted)" font-size="10" font-family="JetBrains Mono">0</text>
              <text x="20" y="90" fill="var(--text-muted)" font-size="10" font-family="JetBrains Mono">2.5</text>
              <text x="20" y="15" fill="var(--text-muted)" font-size="10" font-family="JetBrains Mono">5.0</text>
              <line x1="50" y1="85" x2="460" y2="85" stroke="var(--border)" stroke-width="1" stroke-dasharray="4,4"/>
              <polyline points="100,130 200,115 300,100 400,88" fill="none" stroke="var(--blue)" stroke-width="2.5" stroke-linecap="round"/>
              <circle cx="100" cy="130" r="4" fill="var(--blue)"/><circle cx="200" cy="115" r="4" fill="var(--blue)"/><circle cx="300" cy="100" r="4" fill="var(--blue)"/><circle cx="400" cy="88" r="4" fill="var(--blue)"/>
              <text x="100" y="148" fill="var(--text-secondary)" font-size="10" text-anchor="middle" font-family="DM Sans">Q1'25</text>
              <text x="200" y="148" fill="var(--text-secondary)" font-size="10" text-anchor="middle">Q2'25</text>
              <text x="300" y="148" fill="var(--text-secondary)" font-size="10" text-anchor="middle">Q3'25</text>
              <text x="400" y="148" fill="var(--text-secondary)" font-size="10" text-anchor="middle">Q4'25</text>
              <text x="410" y="84" fill="var(--blue)" font-size="10" font-family="JetBrains Mono">2.36</text>
            </svg>
          </div>
        </div>
        <div class="card">
          <div class="card-title">Por√≥wnanie Jednostek ‚Äî Ostatnia Ocena</div>
          <div id="cis-compare-bars"></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CIS ASSESSMENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-cis-assess">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <div style="display:flex;gap:8px;align-items:center;">
          <select class="form-control" style="width:200px"><option>Ca≈Ça organizacja</option><option>Rozw√≥j Oprogramowania</option><option>Infrastruktura & Ops</option><option>Konsulting IT</option></select>
          <span class="score-badge" style="background:var(--blue-dim);color:var(--blue);">Robocza</span>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-sm">üíæ Zapisz roboczƒÖ</button>
          <button class="btn btn-primary btn-sm">‚úÖ Zatwierd≈∫</button>
        </div>
      </div>
      <div class="grid-4" id="cis-assess-kpis"></div>
      <div id="cis-controls-list"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ORG STRUCTURE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-org-structure">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <div><span style="font-size:13px;color:var(--text-secondary);">Hierarchia: Organizacja ‚Üí Pion ‚Üí Dzia≈Ç ‚Üí Zesp√≥≈Ç</span></div>
        <button class="btn btn-primary btn-sm" onclick="showModal('org-form')">+ Dodaj jednostkƒô</button>
      </div>
      <div class="grid-1-2">
        <div class="card">
          <div class="card-title">Drzewo Struktury</div>
          <div id="org-tree"></div>
        </div>
        <div class="card">
          <div class="card-title">Szczeg√≥≈Çy Jednostki</div>
          <div id="org-detail"></div>
        </div>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CATALOGS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-catalogs">
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <button class="btn btn-sm catalog-tab active" data-cat="threats">üî¥ Zagro≈ºenia <span class="badge badge-red" style="margin-left:4px">24</span></button>
        <button class="btn btn-sm catalog-tab" data-cat="vulns">üü° Podatno≈õci <span class="badge badge-yellow" style="margin-left:4px">31</span></button>
        <button class="btn btn-sm catalog-tab" data-cat="controls">üü¢ Zabezpieczenia <span class="badge badge-green" style="margin-left:4px">42</span></button>
      </div>
      <div class="card" style="padding:0;overflow:hidden;">
        <table class="data-table" id="catalog-table"></table>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DICTIONARIES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-dictionaries">
      <div class="grid-3" id="dict-list"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUDIT TRAIL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="view" id="view-audit">
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <select class="form-control" style="width:160px"><option>Wszystkie modu≈Çy</option><option>Analiza Ryzyka</option><option>CIS Benchmark</option><option>Struktura Org.</option><option>S≈Çowniki</option></select>
        <input type="date" class="form-control" style="width:160px" value="2026-01-01">
        <input type="date" class="form-control" style="width:160px" value="2026-02-09">
      </div>
      <div class="card" style="padding:0;overflow:hidden;">
        <table class="data-table" id="audit-table"></table>
      </div>
    </div>

  </div>
</div>

<!-- MODAL -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h3 id="modal-title">Dodaj ryzyko</h3>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê
const BUs = [
  {id:'dev',name:'Rozw√≥j Oprogramowania',short:'DEV',owner:'Jan Kowalski',security:'Anna Nowak',status:'Aktywna'},
  {id:'infra',name:'Infrastruktura & Ops',short:'INFRA',owner:'Piotr Zieli≈Ñski',security:'Marek Wi≈õniewski',status:'Aktywna'},
  {id:'cons',name:'Konsulting IT',short:'CONS',owner:'Maria Lewandowska',security:'Tomasz Kami≈Ñski',status:'Aktywna'},
  {id:'cloud',name:'Us≈Çugi Chmurowe',short:'CLOUD',owner:'Agnieszka W√≥jcik',security:'Robert Szyma≈Ñski',status:'Aktywna'},
  {id:'data',name:'Dane & AI',short:'DATA',owner:'Krzysztof DƒÖbrowski',security:'Ewa Jankowska',status:'Aktywna'},
  {id:'sup',name:'Wsparcie Techniczne',short:'SUP',owner:'Aleksandra Mazur',security:'Micha≈Ç Krawczyk',status:'Aktywna'},
];

const areas = ['Stacje robocze','UrzƒÖdzenia mobilne','DLP','Urz. wielofunkcyjne','Dok. papierowa','≈öwiadomo≈õƒá','Ludzie','Sieƒá','Serwery','Infra techniczna','M365','Kontrola dostƒôpu','Chmury publiczne'];

const scores = {
  dev:[72,55,45,60,40,65,60,78,80,75,70,50,68],
  infra:[82,40,60,55,35,50,55,88,90,85,65,72,75],
  cons:[60,65,35,45,25,70,68,55,50,52,75,40,42],
  cloud:[75,60,55,50,45,60,58,82,85,80,80,65,88],
  data:[68,50,30,40,30,55,50,70,75,72,68,42,60],
  sup:[65,70,40,55,38,75,72,60,55,58,72,48,45],
};

const risks = [
  {id:'R001',asset:'Laptopy konsultant√≥w',bu:'CONS',area:'DLP',W:3,P:3,Z:0.10,status:'W mitygacji',owner:'T. Kami≈Ñski',R:602.6},
  {id:'R002',asset:'Baza klient√≥w',bu:'DATA',area:'Kontrola dostƒôpu',W:3,P:2,Z:0.25,status:'Zidentyfikowane',owner:'E. Jankowska',R:160.7},
  {id:'R003',asset:'Dokumenty projektowe',bu:'CONS',area:'Dok. papierowa',W:2,P:3,Z:0.10,status:'W analizie',owner:'M. Lewandowska',R:221.7},
  {id:'R004',asset:'≈örodowisko produkcyjne',bu:'CLOUD',area:'Chmury publiczne',W:3,P:2,Z:0.70,status:'W mitygacji',owner:'R. Szyma≈Ñski',R:57.4},
  {id:'R005',asset:'Repozytoria kodu',bu:'DEV',area:'Serwery',W:3,P:1,Z:0.25,status:'Zaakceptowane',owner:'A. Nowak',R:80.3},
  {id:'R006',asset:'Poczta korporacyjna',bu:'INFRA',area:'M365',W:2,P:2,Z:0.70,status:'W mitygacji',owner:'M. Wi≈õniewski',R:21.1},
  {id:'R007',asset:'MDM',bu:'INFRA',area:'UrzƒÖdzenia mobilne',W:2,P:3,Z:0.25,status:'Zidentyfikowane',owner:'M. Wi≈õniewski',R:88.7},
  {id:'R008',asset:'Szkolenia phishing',bu:'DATA',area:'≈öwiadomo≈õƒá',W:2,P:3,Z:0.25,status:'W mitygacji',owner:'E. Jankowska',R:88.7},
];

const cisControls = [
  {num:1,name:'Inwentaryzacja zasob√≥w sprzƒôtowych',nameEn:'Inventory and Control of Enterprise Assets',subs:5,score:0.28},
  {num:2,name:'Inwentaryzacja oprogramowania',nameEn:'Inventory and Control of Software Assets',subs:7,score:0.49},
  {num:3,name:'Ochrona danych',nameEn:'Data Protection',subs:13,score:0.48},
  {num:4,name:'Bezpieczna konfiguracja',nameEn:'Secure Configuration',subs:11,score:0.62},
  {num:5,name:'ZarzƒÖdzanie kontami',nameEn:'Account Management',subs:6,score:0.39},
  {num:6,name:'ZarzƒÖdzanie dostƒôpem',nameEn:'Access Control Management',subs:8,score:0.53},
  {num:7,name:'ZarzƒÖdzanie podatno≈õciami',nameEn:'Continuous Vulnerability Management',subs:7,score:0.68},
  {num:8,name:'ZarzƒÖdzanie logami',nameEn:'Audit Log Management',subs:11,score:0.53},
  {num:9,name:'Ochrona poczty i przeglƒÖdarki',nameEn:'Email and Web Browser Protections',subs:7,score:0.38},
  {num:10,name:'Ochrona przed malware',nameEn:'Malware Defenses',subs:7,score:0.59},
  {num:11,name:'Odzyskiwanie danych',nameEn:'Data Recovery',subs:5,score:0.00},
  {num:12,name:'ZarzƒÖdzanie infrastrukturƒÖ sieciowƒÖ',nameEn:'Network Infrastructure Management',subs:8,score:0.00},
  {num:13,name:'Monitorowanie i obrona sieci',nameEn:'Network Monitoring and Defense',subs:10,score:0.61},
  {num:14,name:'Szkolenia bezpiecze≈Ñstwa',nameEn:'Security Awareness and Skills Training',subs:9,score:0.88},
  {num:15,name:'ZarzƒÖdzanie dostawcami',nameEn:'Service Provider Management',subs:7,score:0.48},
  {num:16,name:'Bezpiecze≈Ñstwo oprogramowania',nameEn:'Application Software Security',subs:13,score:0.00},
  {num:17,name:'ZarzƒÖdzanie incydentami',nameEn:'Incident Response Management',subs:9,score:0.96},
  {num:18,name:'Testy penetracyjne',nameEn:'Penetration Testing',subs:5,score:0.20},
];

const auditLog = [
  {ts:'2026-02-09 07:45',user:'j.kowalski',module:'Analiza Ryzyka',object:'R001',field:'Status',old:'W analizie',new:'W mitygacji'},
  {ts:'2026-02-08 16:20',user:'a.nowak',module:'CIS Benchmark',object:'Ocena #4',field:'CSC #4 / 4.1 Policy',old:'Partial Written Policy',new:'Written Policy'},
  {ts:'2026-02-08 14:05',user:'e.jankowska',module:'Analiza Ryzyka',object:'R002',field:'Prawdopodobie≈Ñstwo',old:'3',new:'2'},
  {ts:'2026-02-07 11:30',user:'m.wisniewski',module:'Katalog Zabezpiecze≈Ñ',object:'ZAB-015',field:'Status',old:'Aktywny',new:'Archiwalny'},
  {ts:'2026-02-07 09:15',user:'t.kaminski',module:'Struktura Org.',object:'CONS-02',field:'Security Contact',old:'(brak)',new:'T. Kami≈Ñski'},
  {ts:'2026-02-06 15:50',user:'r.szymanski',module:'CIS Benchmark',object:'Ocena #4',field:'CSC #7 / 7.3 Implemented',old:'Not Implemented',new:'Implemented on Some Systems'},
  {ts:'2026-02-06 10:00',user:'a.nowak',module:'Analiza Ryzyka',object:'R008',field:'Utworzono',old:'-',new:'Nowy wpis'},
];

// ‚ïê‚ïê‚ïê UTILS ‚ïê‚ïê‚ïê
function getColor(s){return s>=75?'var(--green)':s>=50?'var(--yellow)':s>=25?'var(--orange)':'var(--red)';}
function getLevel(s){return s>=75?'low':s>=50?'medium':s>=25?'high':'critical';}
function getBg(s){return s>=75?'var(--green-dim)':s>=50?'var(--yellow-dim)':s>=25?'var(--orange-dim)':'var(--red-dim)';}
function avg(a){return Math.round(a.reduce((x,y)=>x+y,0)/a.length);}
function riskColor(R){return R>=221?'var(--red)':R>=31?'var(--orange)':'var(--green)';}
function riskBg(R){return R>=221?'var(--red-dim)':R>=31?'var(--orange-dim)':'var(--green-dim)';}
function riskLabel(R){return R>=221?'Wysokie':R>=31?'≈örednie':'Niskie';}
function cisColor(s){return s>=0.7?'var(--green)':s>=0.4?'var(--yellow)':s>0?'var(--orange)':'var(--red)';}
function pct(v){return Math.round(v*100)+'%';}

// ‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê
const titles = {
  'dashboard':'Executive Summary','risks':'Rejestr Ryzyk','reviews':'PrzeglƒÖdy Ryzyk',
  'cis-list':'CIS Benchmark ‚Äî Historia Ocen','cis-assess':'CIS Benchmark ‚Äî Formularz Oceny',
  'org-structure':'Struktura Organizacyjna','catalogs':'Katalogi','dictionaries':'S≈Çowniki','audit':'Audit Trail'
};

function switchView(id) {
  document.querySelectorAll('.sidebar-item').forEach(i=>i.classList.remove('active'));
  document.querySelector(`.sidebar-item[data-view="${id}"]`)?.classList.add('active');
  document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
  document.getElementById('view-'+id).classList.add('active');
  document.getElementById('topbar-title').textContent = titles[id]||id;
}
document.querySelectorAll('.sidebar-item').forEach(item => {
  item.onclick = () => switchView(item.dataset.view);
});

// ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê
function showModal(type) {
  const overlay = document.getElementById('modal-overlay');
  const title = document.getElementById('modal-title');
  const body = document.getElementById('modal-body');
  if(type==='risk-form') {
    title.textContent = 'Dodaj ryzyko';
    body.innerHTML = `
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
        <div class="form-group"><label>Jednostka organizacyjna</label><select class="form-control"><option>Wybierz...</option>${BUs.map(b=>`<option>${b.name}</option>`).join('')}</select></div>
        <div class="form-group"><label>Kategoria aktywa</label><select class="form-control"><option>Wybierz...</option><option>Sprzƒôt IT</option><option>Oprogramowanie</option><option>Dane</option><option>Ludzie</option><option>Procesy</option><option>Infrastruktura fizyczna</option></select></div>
        <div class="form-group" style="grid-column:span 2"><label>Nazwa aktywa</label><input class="form-control" placeholder="np. Laptopy konsultant√≥w"></div>
        <div class="form-group"><label>Wra≈ºliwo≈õƒá</label><select class="form-control"><option>Zwyk≈Çe</option><option>Poufne</option></select></div>
        <div class="form-group"><label>Krytyczno≈õƒá</label><select class="form-control"><option>Niska</option><option>≈örednia</option><option>Wysoka</option></select></div>
        <div class="form-group"><label>Obszar raportowania</label><select class="form-control">${areas.map(a=>`<option>${a}</option>`).join('')}</select></div>
        <div class="form-group"><label>Zagro≈ºenie</label><select class="form-control"><option>Wybierz lub dodaj...</option><option>Atak ransomware</option><option>Phishing</option><option>Wyciek danych</option><option>Nieautoryzowany dostƒôp</option><option>+ Dodaj nowe zagro≈ºenie</option></select></div>
        <div class="form-group"><label>Podatno≈õƒá</label><select class="form-control"><option>Wybierz lub dodaj...</option><option>Brak szyfrowania</option><option>S≈Çabe has≈Ça</option><option>Brak MFA</option><option>Nieaktualne oprogramowanie</option><option>+ Dodaj nowƒÖ podatno≈õƒá</option></select></div>
        <div class="form-group"><label>Poziom wp≈Çywu (W)</label><select class="form-control"><option>1 ‚Äî Niski</option><option>2 ‚Äî ≈öredni</option><option selected>3 ‚Äî Wysoki</option></select></div>
        <div class="form-group"><label>Prawdopodobie≈Ñstwo (P)</label><select class="form-control"><option>1 ‚Äî Niskie</option><option selected>2 ‚Äî ≈örednie</option><option>3 ‚Äî Wysokie</option></select></div>
        <div class="form-group"><label>Ocena zabezpiecze≈Ñ (Z)</label><select class="form-control"><option>0,10 ‚Äî Brak zabezpiecze≈Ñ</option><option selected>0,25 ‚Äî Czƒô≈õciowe</option><option>0,70 ‚Äî Dobra jako≈õƒá</option><option>0,95 ‚Äî Skuteczne, testowane</option></select></div>
        <div class="form-group">
          <label>IstniejƒÖce zabezpieczenia</label>
          <div class="tag-list"><div class="tag">Firewall <span class="tag-remove">‚úï</span></div><div class="tag">VPN <span class="tag-remove">‚úï</span></div></div>
          <select class="form-control" style="margin-top:6px"><option>+ Dodaj zabezpieczenie...</option><option>Antywirus</option><option>MFA</option><option>Szyfrowanie dysku</option></select>
        </div>
        <div class="form-group"><label>Strategia postƒôpowania</label><select class="form-control"><option>Mitygacja</option><option>Akceptacja</option><option>Transfer</option><option>Unikanie</option></select></div>
        <div class="form-group"><label>W≈Ça≈õciciel ryzyka</label><input class="form-control" placeholder="np. Jan Kowalski"></div>
        <div class="form-group"><label>Status</label><select class="form-control"><option>Zidentyfikowane</option><option>W analizie</option><option>W mitygacji</option><option>Zaakceptowane</option></select></div>
      </div>
      <div class="form-group"><label>Planowane dzia≈Çania</label><textarea class="form-control" placeholder="Opisz planowane kroki mitygacyjne..."></textarea></div>
      <div class="card" style="background:var(--bg-primary);margin-top:12px;text-align:center;">
        <div style="font-size:11px;color:var(--text-muted);margin-bottom:6px;">OBLICZONA OCENA RYZYKA (R = EXP(W) √ó P / Z)</div>
        <div style="font-size:36px;font-weight:700;font-family:'JetBrains Mono';color:var(--orange);">160.7</div>
        <div class="score-badge" style="background:var(--orange-dim);color:var(--orange);margin-top:6px;">≈örednie</div>
      </div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px;">
        <button class="btn" onclick="closeModal()">Anuluj</button>
        <button class="btn btn-primary" onclick="closeModal()">Zapisz ryzyko</button>
      </div>`;
  } else if(type==='org-form') {
    title.textContent = 'Dodaj jednostkƒô organizacyjnƒÖ';
    body.innerHTML = `
      <div class="form-group"><label>Jednostka nadrzƒôdna</label><select class="form-control"><option>‚Äî ROOT ‚Äî</option><option>Acme IT Solutions (Organizacja)</option><option>&nbsp;&nbsp;Rozw√≥j Oprogramowania (Pion)</option><option>&nbsp;&nbsp;Infrastruktura & Ops (Pion)</option></select></div>
      <div style="display:grid;grid-template-columns:2fr 1fr;gap:14px;">
        <div class="form-group"><label>Nazwa</label><input class="form-control" placeholder="np. Dzia≈Ç Frontend"></div>
        <div class="form-group"><label>Symbol</label><input class="form-control" placeholder="np. FE"></div>
      </div>
      <div class="form-group"><label>W≈Ça≈õciciel biznesowy</label><input class="form-control"></div>
      <div class="form-group"><label>Security Contact</label><input class="form-control"></div>
      <div class="form-group"><label>Opis</label><textarea class="form-control"></textarea></div>
      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px;">
        <button class="btn" onclick="closeModal()">Anuluj</button>
        <button class="btn btn-primary" onclick="closeModal()">Zapisz</button>
      </div>`;
  }
  overlay.classList.add('active');
}
function closeModal() { document.getElementById('modal-overlay').classList.remove('active'); }
document.getElementById('modal-overlay').onclick = e => { if(e.target.id==='modal-overlay') closeModal(); };

// ‚ïê‚ïê‚ïê RENDER: Dashboard ‚ïê‚ïê‚ïê
function renderDashboard() {
  const overall = avg(BUs.map(b=>avg(scores[b.id])));
  const critRisks = risks.filter(r=>r.R>=221).length;
  const highRisks = risks.filter(r=>r.R>=31&&r.R<221).length;
  const cisAvg = Math.round(cisControls.reduce((a,c)=>a+c.score,0)/cisControls.length*100);

  document.getElementById('dash-kpis').innerHTML = [
    {v:overall,l:'Og√≥lny Wynik',t:'‚Üë +4 vs Q3',c:getColor(overall),bg:getBg(overall)},
    {v:critRisks,l:'Ryzyka Krytyczne',t:'Wymaga akcji',c:'var(--red)',bg:'var(--red-dim)'},
    {v:highRisks,l:'Ryzyka ≈örednie',t:'‚Üì -1 vs Q3',c:'var(--orange)',bg:'var(--orange-dim)'},
    {v:cisAvg+'%',l:'CIS Maturity Avg',t:'‚Üë +3%',c:getColor(cisAvg),bg:getBg(cisAvg)},
  ].map(k=>`<div class="card kpi"><div class="value" style="color:${k.c}">${k.v}</div><div class="label">${k.l}</div><div class="trend" style="background:${k.bg};color:${k.c}">${k.t}</div></div>`).join('');

  // Ring
  const circ=2*Math.PI*50, offset=circ-(overall/100)*circ;
  document.getElementById('dash-ring').innerHTML=`<div class="score-ring"><svg width="120" height="120" viewBox="0 0 120 120"><circle class="ring-bg" cx="60" cy="60" r="50"/><circle class="ring-fill" cx="60" cy="60" r="50" stroke="${getColor(overall)}" stroke-dasharray="${circ}" stroke-dashoffset="${offset}"/></svg><div class="ring-label"><div class="num" style="color:${getColor(overall)}">${overall}</div><div class="of">/ 100</div></div></div>`;

  // Heatmap
  const cols=BUs.length;
  let hm=`<div class="heatmap-grid"><div class="heatmap-row" style="grid-template-columns:130px repeat(${cols},1fr)"><div></div>${BUs.map(b=>`<div class="heatmap-header">${b.short}</div>`).join('')}</div>`;
  areas.forEach((a,ai)=>{
    hm+=`<div class="heatmap-row" style="grid-template-columns:130px repeat(${cols},1fr)"><div class="heatmap-label">${a}</div>`;
    BUs.forEach(b=>{const s=scores[b.id][ai];hm+=`<div class="heatmap-cell" style="background:${getColor(s)};color:${s>=50&&s<75?'#1a1a1a':'#fff'}">${s}</div>`;});
    hm+='</div>';
  });
  hm+='</div>';
  document.getElementById('dash-heatmap').innerHTML=hm;

  // Top risks
  document.getElementById('dash-top-risks').innerHTML=risks.sort((a,b)=>b.R-a.R).slice(0,5).map(r=>`
    <div class="bar-row"><div class="bar-label"><span style="color:var(--text-muted);font-family:'JetBrains Mono';font-size:10px">${r.id}</span> ${r.asset}</div>
    <div class="bar-track"><div class="bar-fill" style="width:${r.R/603*100}%;background:${riskColor(r.R)}" data-value="${r.R.toFixed(1)}"></div></div>
    <div class="bar-score" style="color:${riskColor(r.R)}">${r.R.toFixed(0)}</div></div>`).join('');

  // CIS mini
  document.getElementById('dash-cis-mini').innerHTML=`
    <div style="display:flex;align-items:center;gap:14px;margin-bottom:12px;">
      <div style="font-size:28px;font-family:'JetBrains Mono';font-weight:700;color:var(--yellow)">2.36</div>
      <div><div style="font-size:12px;">Maturity Rating</div><div style="font-size:11px;color:var(--text-muted)">Skala 0‚Äì5</div></div>
    </div>
    ${['IG1: 50%','IG2: 51%','IG3: 49%'].map((g,i)=>`<div style="font-size:11px;color:var(--text-secondary);margin-bottom:4px;">${g}<div style="height:4px;background:rgba(255,255,255,0.06);border-radius:2px;margin-top:2px;"><div style="height:100%;width:${[50,51,49][i]}%;background:var(--yellow);border-radius:2px;"></div></div></div>`).join('')}`;

  // Overdue reviews
  document.getElementById('dash-overdue').innerHTML=[
    {id:'R001',asset:'Laptopy konsultant√≥w',last:'2025-08-15',days:178},
    {id:'R003',asset:'Dokumenty projektowe',last:'2025-09-01',days:161},
    {id:'R005',asset:'Repozytoria kodu',last:'2025-10-12',days:120},
    {id:'R007',asset:'MDM',last:'2025-10-20',days:112},
    {id:'R008',asset:'Szkolenia phishing',last:'2025-11-01',days:100},
  ].map(r=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(42,53,84,0.3);font-size:12px;">
    <div><span style="color:var(--text-muted);font-family:'JetBrains Mono';font-size:10px;">${r.id}</span> ${r.asset}</div>
    <div><span class="score-badge" style="background:var(--red-dim);color:var(--red)">${r.days} dni temu</span></div>
  </div>`).join('');
}

// ‚ïê‚ïê‚ïê RENDER: Risk Register ‚ïê‚ïê‚ïê
function renderRisks() {
  document.getElementById('risk-table').innerHTML=`<thead><tr><th>ID</th><th>Aktywo</th><th>Pion</th><th>Obszar</th><th>W</th><th>P</th><th>Z</th><th>Ocena (R)</th><th>Status</th><th>W≈Ça≈õciciel</th></tr></thead><tbody>`+
  risks.sort((a,b)=>b.R-a.R).map(r=>`<tr style="border-left:3px solid ${riskColor(r.R)}">
    <td style="font-family:'JetBrains Mono';font-size:11px;color:var(--text-muted)">${r.id}</td>
    <td style="font-weight:500">${r.asset}</td><td>${r.bu}</td><td>${r.area}</td>
    <td style="font-family:'JetBrains Mono';font-size:11px">${r.W}</td>
    <td style="font-family:'JetBrains Mono';font-size:11px">${r.P}</td>
    <td style="font-family:'JetBrains Mono';font-size:11px">${r.Z}</td>
    <td><span class="score-badge" style="background:${riskBg(r.R)};color:${riskColor(r.R)}">${r.R.toFixed(1)} ${riskLabel(r.R)}</span></td>
    <td><span class="score-badge" style="background:var(--blue-dim);color:var(--blue)">${r.status}</span></td>
    <td style="font-size:12px;color:var(--text-secondary)">${r.owner}</td></tr>`).join('')+`</tbody>`;
}

// ‚ïê‚ïê‚ïê RENDER: Reviews ‚ïê‚ïê‚ïê
function renderReviews() {
  const overdue = [{id:'R001',asset:'Laptopy konsultant√≥w',last:'2025-08-15',days:178,bu:'CONS'},
    {id:'R003',asset:'Dokumenty projektowe',last:'2025-09-01',days:161,bu:'CONS'},
    {id:'R005',asset:'Repozytoria kodu',last:'2025-10-12',days:120,bu:'DEV'},
    {id:'R007',asset:'MDM',last:'2025-10-20',days:112,bu:'INFRA'},
    {id:'R008',asset:'Szkolenia phishing',last:'2025-11-01',days:100,bu:'DATA'}];
  document.getElementById('review-table').innerHTML=`<thead><tr><th>ID</th><th>Aktywo</th><th>Pion</th><th>Ostatni przeglƒÖd</th><th>Dni od przeglƒÖdu</th><th>Akcja</th></tr></thead><tbody>`+
  overdue.map(r=>`<tr><td style="font-family:'JetBrains Mono';font-size:11px">${r.id}</td><td>${r.asset}</td><td>${r.bu}</td><td>${r.last}</td>
    <td><span class="score-badge" style="background:var(--red-dim);color:var(--red)">${r.days} dni</span></td>
    <td><button class="btn btn-sm">‚úì Oznacz jako przejrzane</button></td></tr>`).join('')+`</tbody>`;
}

// ‚ïê‚ïê‚ïê RENDER: CIS List ‚ïê‚ïê‚ïê
function renderCISList() {
  const assessments = [
    {id:4,date:'2026-01-15',bu:'Ca≈Ça organizacja',assessor:'A. Nowak',maturity:2.36,risk:50,status:'Zatwierdzona'},
    {id:3,date:'2025-10-01',bu:'Ca≈Ça organizacja',assessor:'A. Nowak',maturity:2.12,risk:46,status:'Zatwierdzona'},
    {id:2,date:'2025-07-01',bu:'Rozw√≥j Oprogramowania',assessor:'J. Kowalski',maturity:2.45,risk:52,status:'Zatwierdzona'},
    {id:1,date:'2025-04-01',bu:'Ca≈Ça organizacja',assessor:'A. Nowak',maturity:1.88,risk:41,status:'Zatwierdzona'},
  ];
  document.getElementById('cis-list-table').innerHTML=`<thead><tr><th>#</th><th>Data oceny</th><th>Jednostka</th><th>OceniajƒÖcy</th><th>Maturity Rating</th><th>% Risk Addressed</th><th>Status</th><th>Akcje</th></tr></thead><tbody>`+
  assessments.map(a=>`<tr>
    <td style="font-family:'JetBrains Mono';font-size:11px">${a.id}</td><td>${a.date}</td><td>${a.bu}</td><td>${a.assessor}</td>
    <td><span style="font-family:'JetBrains Mono';font-weight:600;color:var(--yellow)">${a.maturity.toFixed(2)}</span> / 5.0</td>
    <td><span class="score-badge" style="background:${getBg(a.risk)};color:${getColor(a.risk)}">${a.risk}%</span></td>
    <td><span class="score-badge" style="background:var(--green-dim);color:var(--green)">${a.status}</span></td>
    <td><button class="btn btn-sm">üëÅ PodglƒÖd</button> <button class="btn btn-sm">üìã Kopiuj</button></td></tr>`).join('')+`</tbody>`;

  // Compare bars
  document.getElementById('cis-compare-bars').innerHTML=[
    {name:'Ca≈Ça organizacja',s:50},{name:'Rozw√≥j Oprogramowania',s:52},{name:'Infrastruktura & Ops',s:48},
  ].map(b=>`<div class="bar-row"><div class="bar-label">${b.name}</div><div class="bar-track"><div class="bar-fill" style="width:${b.s}%;background:${getColor(b.s)}" data-value="${b.s}%"></div></div><div class="bar-score" style="color:${getColor(b.s)}">${b.s}%</div></div>`).join('');
}

// ‚ïê‚ïê‚ïê RENDER: CIS Assessment ‚ïê‚ïê‚ïê
function renderCISAssess() {
  const cisAvg = Math.round(cisControls.reduce((a,c)=>a+c.score,0)/cisControls.length*100);
  document.getElementById('cis-assess-kpis').innerHTML=[
    {v:'2.36',l:'Maturity Rating (0‚Äì5)',c:'var(--yellow)'},
    {v:cisAvg+'%',l:'Avg Risk Addressed',c:getColor(cisAvg)},
    {v:'Moderate',l:'ATT&CK Preventive',c:'var(--yellow)'},
    {v:'Moderate',l:'ATT&CK Detective',c:'var(--yellow)'},
  ].map(k=>`<div class="card kpi"><div class="value" style="color:${k.c};font-size:26px">${k.v}</div><div class="label">${k.l}</div></div>`).join('');

  const policyOpts = ['','No Policy','Informal Policy','Partial Written Policy','Written Policy','Approved Written Policy','N/A'];
  const implOpts = ['','Not Implemented','Parts of Policy Implemented','Implemented on Some Systems','Implemented on Most Systems','Implemented on All Systems','N/A'];
  const autoOpts = ['','Not Automated','Parts of Policy Automated','Automated on Some Systems','Automated on Most Systems','Automated on All Systems','N/A'];
  const reportOpts = ['','Not Reported','Parts of Policy Reported','Reported on Some Systems','Reported on Most Systems','Reported on All Systems','N/A'];

  function makeSelect(opts,sel){return `<select class="cis-select">${opts.map(o=>`<option${o===sel?' selected':''}>${o||'Wybierz...'}</option>`).join('')}</select>`;}

  let html = '';
  cisControls.forEach(c => {
    const scoreClr = cisColor(c.score);
    html += `<div class="cis-control-card" id="csc-${c.num}">
      <div class="cis-control-header" onclick="this.parentElement.classList.toggle('expanded')">
        <div class="csc-title">
          <span class="csc-num">CSC #${c.num}</span>
          <span class="csc-name">${c.name}</span>
        </div>
        <div style="display:flex;align-items:center;gap:12px;">
          <div style="width:80px;height:5px;background:rgba(255,255,255,0.06);border-radius:3px;overflow:hidden;">
            <div style="width:${c.score*100}%;height:100%;background:${scoreClr};border-radius:3px;"></div>
          </div>
          <span class="csc-score" style="color:${scoreClr}">${pct(c.score)}</span>
          <span style="font-size:12px;color:var(--text-muted)">‚ñº</span>
        </div>
      </div>
      <div class="cis-control-body">
        <div style="font-size:11px;color:var(--text-muted);margin-bottom:8px;">${c.nameEn} ‚Äî ${c.subs} sub-kontroli</div>
        <div class="cis-sub-row" style="font-weight:600;font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.05em;border-bottom:1px solid var(--border);">
          <div>ID</div><div>Opis</div><div>Policy</div><div>Implemented</div><div>Automated</div><div>Reported</div>
        </div>`;
    for(let i=1;i<=c.subs;i++){
      const presets = ['Partial Written Policy','Implemented on Some Systems','Parts of Policy Automated','Not Reported'];
      html+=`<div class="cis-sub-row">
        <div class="cis-sub-id">${c.num}.${i}</div>
        <div class="cis-sub-name" style="font-size:11px;color:var(--text-secondary);">Sub-kontrola ${c.num}.${i}</div>
        ${makeSelect(policyOpts,presets[0])}${makeSelect(implOpts,presets[1])}${makeSelect(autoOpts,presets[2])}${makeSelect(reportOpts,presets[3])}
      </div>`;
    }
    html+=`<div style="display:flex;gap:16px;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);font-size:11px;color:var(--text-secondary);">
      <span>Policies: <strong style="color:var(--text-primary)">${pct(c.score*0.7)}</strong></span>
      <span>Implemented: <strong style="color:var(--text-primary)">${pct(c.score*0.9)}</strong></span>
      <span>Automated: <strong style="color:var(--text-primary)">${pct(c.score*0.6)}</strong></span>
      <span>Reported: <strong style="color:var(--text-primary)">${pct(c.score*0.3)}</strong></span>
    </div></div></div>`;
  });
  document.getElementById('cis-controls-list').innerHTML = html;
}

// ‚ïê‚ïê‚ïê RENDER: Org Structure ‚ïê‚ïê‚ïê
function renderOrgStructure() {
  const depts = [{name:'Dzia≈Ç Frontend',sym:'FE'},{name:'Dzia≈Ç Backend',sym:'BE'},{name:'Dzia≈Ç Mobile',sym:'MOB'},{name:'Dzia≈Ç QA',sym:'QA'}];
  document.getElementById('org-tree').innerHTML=`
    <div class="tree-item root" onclick="showOrgDetail('root')">üè¢ Acme IT Solutions <span class="tree-badge" style="background:var(--green-dim);color:var(--green)">Aktywna</span><div class="tree-meta">Organizacja ¬∑ Symbol: ACME</div></div>
    ${BUs.map(b=>`<div class="tree-item" onclick="showOrgDetail('${b.id}')" style="margin-left:20px;border-left:2px solid var(--border);">
      ${b.id==='dev'?'üíª':b.id==='infra'?'üñ•':b.id==='cons'?'üíº':b.id==='cloud'?'‚òÅÔ∏è':b.id==='data'?'üìä':'üîß'} ${b.name}
      <span class="tree-badge" style="background:var(--green-dim);color:var(--green)">Aktywna</span>
      <div class="tree-meta">Pion ¬∑ ${b.short} ¬∑ ${b.owner}</div>
    </div>
    ${b.id==='dev'?depts.map(d=>`<div class="tree-item" style="margin-left:44px;border-left:2px solid rgba(42,53,84,0.5);">üìÅ ${d.name}<div class="tree-meta">Dzia≈Ç ¬∑ ${d.sym}</div></div>`).join(''):''}
    `).join('')}`;

  showOrgDetail('dev');
}
function showOrgDetail(id) {
  const bu = BUs.find(b=>b.id===id);
  if(!bu) {
    document.getElementById('org-detail').innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div class="form-group"><label>Nazwa</label><input class="form-control" value="Acme IT Solutions"></div>
      <div class="form-group"><label>Symbol</label><input class="form-control" value="ACME"></div>
      <div class="form-group"><label>W≈Ça≈õciciel</label><input class="form-control" value="CEO ‚Äî Adam Nowicki"></div>
      <div class="form-group"><label>Security Contact</label><input class="form-control" value="CISO"></div>
      <div class="form-group"><label>Status</label><select class="form-control"><option selected>Aktywna</option><option>Nieaktywna</option></select></div>
      <div class="form-group"><label>Data utworzenia</label><input class="form-control" value="2020-01-01" disabled></div>
    </div><div class="form-group"><label>Opis</label><textarea class="form-control">G≈Ç√≥wna jednostka organizacyjna firmy Acme IT Solutions Sp. z o.o.</textarea></div>`;
    return;
  }
  document.getElementById('org-detail').innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
    <div class="form-group"><label>Nazwa</label><input class="form-control" value="${bu.name}"></div>
    <div class="form-group"><label>Symbol</label><input class="form-control" value="${bu.short}"></div>
    <div class="form-group"><label>W≈Ça≈õciciel biznesowy</label><input class="form-control" value="${bu.owner}"></div>
    <div class="form-group"><label>Security Contact</label><input class="form-control" value="${bu.security}"></div>
    <div class="form-group"><label>Status</label><select class="form-control"><option selected>Aktywna</option><option>Nieaktywna</option></select></div>
    <div class="form-group"><label>Data utworzenia</label><input class="form-control" value="2020-01-01" disabled></div>
  </div><div class="form-group"><label>Opis</label><textarea class="form-control">Pion odpowiedzialny za ${bu.name.toLowerCase()}.</textarea></div>
  <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px;">
    <button class="btn btn-sm" style="color:var(--red);border-color:rgba(239,68,68,0.3);">Dezaktywuj</button>
    <button class="btn btn-primary btn-sm">üíæ Zapisz zmiany</button>
  </div>`;
}

// ‚ïê‚ïê‚ïê RENDER: Catalogs ‚ïê‚ïê‚ïê
function renderCatalogs(type) {
  document.querySelectorAll('.catalog-tab').forEach(t=>t.classList.remove('active'));
  document.querySelector(`.catalog-tab[data-cat="${type}"]`)?.classList.add('active');

  const data = {
    threats: [
      {id:'ZAG-001',name:'Atak ransomware',cat:'Cybernetyczne',status:'Aktywny'},
      {id:'ZAG-002',name:'Phishing / spear-phishing',cat:'Cybernetyczne',status:'Aktywny'},
      {id:'ZAG-003',name:'Wyciek danych przez pracownika',cat:'Ludzkie',status:'Aktywny'},
      {id:'ZAG-004',name:'Nieautoryzowany dostƒôp fizyczny',cat:'Fizyczne',status:'Aktywny'},
      {id:'ZAG-005',name:'Atak DDoS',cat:'Cybernetyczne',status:'Aktywny'},
      {id:'ZAG-006',name:'Exploitacja podatno≈õci zero-day',cat:'Cybernetyczne',status:'Aktywny'},
    ],
    vulns: [
      {id:'POD-001',name:'Brak szyfrowania danych w spoczynku',area:'DLP',status:'Aktywny'},
      {id:'POD-002',name:'S≈Çabe/domy≈õlne has≈Ça',area:'Kontrola dostƒôpu',status:'Aktywny'},
      {id:'POD-003',name:'Brak MFA',area:'Kontrola dostƒôpu',status:'Aktywny'},
      {id:'POD-004',name:'Nieaktualne oprogramowanie',area:'Stacje robocze',status:'Aktywny'},
      {id:'POD-005',name:'Otwarte porty sieciowe',area:'Sieƒá',status:'Aktywny'},
    ],
    controls: [
      {id:'ZAB-001',name:'Firewall next-gen',typ:'Prewencyjne',status:'Aktywny'},
      {id:'ZAB-002',name:'MFA (Multi-Factor Authentication)',typ:'Prewencyjne',status:'Aktywny'},
      {id:'ZAB-003',name:'EDR / XDR',typ:'Detekcyjne',status:'Aktywny'},
      {id:'ZAB-004',name:'Szyfrowanie dysk√≥w (BitLocker)',typ:'Prewencyjne',status:'Aktywny'},
      {id:'ZAB-005',name:'SIEM',typ:'Detekcyjne',status:'Aktywny'},
      {id:'ZAB-006',name:'Backup & Recovery',typ:'Korekcyjne',status:'Aktywny'},
    ],
  };

  const items = data[type] || [];
  const headers = type==='threats'?['ID','Nazwa zagro≈ºenia','Kategoria','Status']:
                  type==='vulns'?['ID','Nazwa podatno≈õci','Obszar','Status']:
                  ['ID','Nazwa zabezpieczenia','Typ','Status'];

  document.getElementById('catalog-table').innerHTML=`<thead><tr>${headers.map(h=>`<th>${h}</th>`).join('')}<th>Akcje</th></tr></thead><tbody>`+
  items.map(i=>`<tr>
    <td style="font-family:'JetBrains Mono';font-size:11px;color:var(--text-muted)">${i.id}</td>
    <td style="font-weight:500">${i.name}</td>
    <td>${i.cat||i.area||i.typ||''}</td>
    <td><span class="score-badge" style="background:var(--green-dim);color:var(--green)">${i.status}</span></td>
    <td><button class="btn btn-sm">‚úèÔ∏è Edytuj</button></td>
  </tr>`).join('')+`</tbody>`;
}
document.querySelectorAll('.catalog-tab').forEach(t=>t.onclick=()=>renderCatalogs(t.dataset.cat));

// ‚ïê‚ïê‚ïê RENDER: Dictionaries ‚ïê‚ïê‚ïê
function renderDictionaries() {
  const dicts = [
    {name:'Kategorie aktyw√≥w',items:['Sprzƒôt IT','Oprogramowanie','Dane','Ludzie','Procesy','Infrastruktura fizyczna'],count:6},
    {name:'Wra≈ºliwo≈õƒá',items:['Zwyk≈Çe','Poufne'],count:2},
    {name:'Krytyczno≈õƒá',items:['Niska','≈örednia','Wysoka'],count:3},
    {name:'Poziomy wp≈Çywu',items:['1 ‚Äî Niski','2 ‚Äî ≈öredni','3 ‚Äî Wysoki'],count:3},
    {name:'Poziomy prawdopodobie≈Ñstwa',items:['1 ‚Äî Niskie','2 ‚Äî ≈örednie','3 ‚Äî Wysokie'],count:3},
    {name:'Ocena zabezpiecze≈Ñ',items:['0,95 ‚Äî Skuteczne','0,70 ‚Äî Dobra jako≈õƒá','0,25 ‚Äî Czƒô≈õciowe','0,10 ‚Äî Brak'],count:4},
    {name:'Statusy ryzyka',items:['Zidentyfikowane','W analizie','Zaakceptowane','W mitygacji','Zamkniƒôte'],count:5},
    {name:'Strategie postƒôpowania',items:['Mitygacja','Akceptacja','Transfer','Unikanie'],count:4},
    {name:'Kategorie zagro≈ºe≈Ñ',items:['Cybernetyczne','Fizyczne','Ludzkie'],count:3},
    {name:'Typy zabezpiecze≈Ñ',items:['Prewencyjne','Detekcyjne','Korekcyjne'],count:3},
    {name:'Status polityki (CIS)',items:['No Policy','Informal','Partial Written','Written','Approved Written'],count:5},
    {name:'Status oceny CIS',items:['Robocza','Zatwierdzona'],count:2},
  ];
  document.getElementById('dict-list').innerHTML=dicts.map(d=>`
    <div class="card" style="cursor:pointer;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
        <div class="card-title" style="margin:0">${d.name}</div>
        <span class="badge badge-blue" style="font-size:10px;padding:2px 8px;border-radius:8px;">${d.count}</span>
      </div>
      <div style="display:flex;flex-wrap:wrap;gap:4px;">
        ${d.items.map(i=>`<span style="font-size:11px;padding:3px 8px;border-radius:4px;background:rgba(255,255,255,0.04);color:var(--text-secondary);">${i}</span>`).join('')}
      </div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê RENDER: Audit Trail ‚ïê‚ïê‚ïê
function renderAudit() {
  document.getElementById('audit-table').innerHTML=`<thead><tr><th>Timestamp</th><th>U≈ºytkownik</th><th>Modu≈Ç</th><th>Obiekt</th><th>Pole</th><th>Stara warto≈õƒá</th><th>Nowa warto≈õƒá</th></tr></thead><tbody>`+
  auditLog.map(a=>`<tr>
    <td style="font-family:'JetBrains Mono';font-size:11px;color:var(--text-muted)">${a.ts}</td>
    <td>${a.user}</td><td><span class="score-badge" style="background:var(--purple-dim);color:var(--purple)">${a.module}</span></td>
    <td style="font-family:'JetBrains Mono';font-size:11px">${a.object}</td><td>${a.field}</td>
    <td style="color:var(--red);font-size:12px">${a.old}</td><td style="color:var(--green);font-size:12px">${a.new}</td>
  </tr>`).join('')+`</tbody>`;
}

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
renderDashboard();
renderRisks();
renderReviews();
renderCISList();
renderCISAssess();
renderOrgStructure();
renderCatalogs('threats');
renderDictionaries();
renderAudit();
</script>
</body>
</html>
